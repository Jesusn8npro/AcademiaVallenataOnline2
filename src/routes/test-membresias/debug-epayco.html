<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagn√≥stico ePayco - Academia Vallenata</title>
    <script src="https://checkout.epayco.co/checkout.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .credentials { background: #f8f9fa; padding: 10px; border-radius: 4px; margin: 10px 0; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üîç Diagn√≥stico Completo ePayco</h1>
    
    <div class="section info">
        <h2>üìã Variables de Entorno</h2>
        <div id="env-check"></div>
    </div>

    <div class="section warning">
        <h2>‚ö†Ô∏è Verificaci√≥n de Configuraci√≥n</h2>
        <button onclick="verificarConfiguracion()">Verificar Configuraci√≥n ePayco</button>
        <div id="config-result"></div>
    </div>

    <div class="section">
        <h2>üß™ Prueba de Pago Simplificada</h2>
        <button onclick="pruebaSimplificada()">Probar Pago B√°sico</button>
        <div id="test-result"></div>
    </div>

    <div class="section">
        <h2>üìä Par√°metros de Prueba</h2>
        <pre id="test-params"></pre>
    </div>

    <script>
        // Variables simuladas (reemplazar con las reales del servidor)
        const CONFIG = {
            public_key: 'tu_public_key_aqui',
            test_mode: 'true',
            customer_id: 'tu_customer_id_aqui'
        };

        function mostrarVariablesEntorno() {
            const envDiv = document.getElementById('env-check');
            envDiv.innerHTML = `
                <div class="credentials">
                    <strong>üîë VITE_EPAYCO_PUBLIC_KEY:</strong> ${CONFIG.public_key || '‚ùå NO CONFIGURADA'}<br>
                    <strong>üß™ VITE_EPAYCO_TEST_MODE:</strong> ${CONFIG.test_mode || '‚ùå NO CONFIGURADA'}<br>
                    <strong>üë§ VITE_EPAYCO_CUSTOMER_ID:</strong> ${CONFIG.customer_id || '‚ùå NO CONFIGURADA'}
                </div>
            `;
        }

        function verificarConfiguracion() {
            const resultDiv = document.getElementById('config-result');
            
            // Verificar que ePayco est√© cargado
            if (typeof ePayco === 'undefined') {
                resultDiv.innerHTML = '<div class="error">‚ùå <strong>ERROR CR√çTICO:</strong> ePayco no est√° cargado</div>';
                return;
            }

            // Verificar variables
            let errores = [];
            if (!CONFIG.public_key || CONFIG.public_key === 'tu_public_key_aqui') {
                errores.push('Public Key no configurada');
            }
            if (!CONFIG.customer_id || CONFIG.customer_id === 'tu_customer_id_aqui') {
                errores.push('Customer ID no configurado');
            }
            if (CONFIG.test_mode !== 'true') {
                errores.push('Test Mode no est√° en true');
            }

            if (errores.length > 0) {
                resultDiv.innerHTML = `<div class="error">‚ùå <strong>ERRORES ENCONTRADOS:</strong><br>‚Ä¢ ${errores.join('<br>‚Ä¢ ')}</div>`;
            } else {
                resultDiv.innerHTML = '<div class="success">‚úÖ <strong>Configuraci√≥n correcta</strong></div>';
            }
        }

        function pruebaSimplificada() {
            const resultDiv = document.getElementById('test-result');
            
            if (typeof ePayco === 'undefined') {
                resultDiv.innerHTML = '<div class="error">‚ùå ePayco no disponible</div>';
                return;
            }

            try {
                // Configuraci√≥n m√≠nima de prueba
                const handler = ePayco.checkout.configure({
                    key: CONFIG.public_key,
                    test: true
                });

                const data = {
                    // Informaci√≥n b√°sica
                    name: "Prueba Diagn√≥stico",
                    description: "Prueba de configuraci√≥n ePayco",
                    currency: "cop",
                    amount: "1000",
                    tax_base: "840",
                    tax: "160",
                    country: "co",
                    lang: "es",
                    
                    // Informaci√≥n del cliente
                    invoice: "TEST-" + Date.now(),
                    email_billing: "test@academiavallenata.com",
                    name_billing: "Usuario Prueba",
                    type_doc_billing: "cc",
                    mobilephone_billing: "3001234567",
                    
                    // URLs (opcionales para prueba)
                    external: "false"
                };

                // Mostrar par√°metros
                document.getElementById('test-params').textContent = JSON.stringify(data, null, 2);
                
                // Abrir checkout
                handler.open(data);
                
                resultDiv.innerHTML = '<div class="success">‚úÖ <strong>Checkout abierto correctamente</strong><br>Si ves el modal de ePayco, la configuraci√≥n b√°sica funciona.</div>';
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">‚ùå <strong>ERROR:</strong> ${error.message}</div>`;
            }
        }

        // Cargar al inicio
        window.onload = function() {
            mostrarVariablesEntorno();
        };
    </script>

    <div class="section info">
        <h2>üéØ Tarjetas de Prueba Oficiales Bold</h2>
        <div class="credentials">
            <strong>‚úÖ VISA APROBADA:</strong> 4111111111111111<br>
            <strong>‚úÖ MASTERCARD APROBADA:</strong> 5100010000000015<br>
            <strong>‚ùå RECHAZADA:</strong> 4970110000000062<br>
            <strong>üí• FALLIDA:</strong> 5204730000008404<br>
            <strong>üîí CVV:</strong> 123 | <strong>üìÖ Fecha:</strong> 12/29 | <strong>üë§ Nombre:</strong> APPROVED
        </div>
    </div>

    <div class="section warning">
        <h2>üö® Problemas Comunes</h2>
        <ul>
            <li><strong>Tarjeta restringida:</strong> Comercio no configurado para sandbox</li>
            <li><strong>Error 300:</strong> Par√°metros incorrectos</li>
            <li><strong>Error 400:</strong> Llaves incorrectas</li>
            <li><strong>Error 401:</strong> Sin permisos</li>
        </ul>
    </div>
</body>
</html> 