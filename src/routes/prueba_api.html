<html lang="es"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåç Test Sistema IpApi.co - Academia Vallenata</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 2rem;
            font-size: 2rem;
        }
        
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 1.5rem;
            border-radius: 12px;
            margin: 1rem 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .test-section h3 {
            margin-top: 0;
            color: #a8e6cf;
        }
        
        button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin: 0.5rem 0.5rem 0.5rem 0;
            transition: all 0.2s ease;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }
        
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .result {
            background: rgba(0, 0, 0, 0.3);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .success {
            border-left: 4px solid #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }
        
        .error {
            border-left: 4px solid #f44336;
            background: rgba(244, 67, 54, 0.1);
        }
        
        .info {
            border-left: 4px solid #2196F3;
            background: rgba(33, 150, 243, 0.1);
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: #a8e6cf;
        }
        
        .stat-label {
            font-size: 0.8rem;
            opacity: 0.8;
            margin-top: 0.25rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåç Test Sistema IpApi.co - ACTUALIZADO</h1>
        <p style="text-align: center; opacity: 0.8;">
            Verificaci√≥n del sistema de geolocalizaci√≥n integrado para Academia Vallenata Online
        </p>
        
        <div class="test-section" style="background: rgba(34, 197, 94, 0.2); border-color: #22c55e;">
            <h3>‚úÖ Sistema Implementado</h3>
            <p><strong>Estado:</strong> Sistema de geolocalizaci√≥n con ipapi.co completamente integrado</p>
            <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
                <li>‚úÖ Servicio profesional: <code>ipapiGeoLocationService.ts</code></li>
                <li>‚úÖ Funciones SQL optimizadas: <code>IMPLEMENTACION_FINAL_IPAPI.sql</code></li>
                <li>‚úÖ Tracking autom√°tico activado en <code>+layout.svelte</code></li>
                <li>‚úÖ Panel admin con bot√≥n "Probar ipapi.co"</li>
                <li>‚úÖ Cache inteligente y rate limiting</li>
            </ul>
        </div>

        <!-- Test 1: Obtener IP -->
        <div class="test-section">
            <h3>üåê Test 1: Obtener IP P√∫blica</h3>
            <p>Verifica que podemos obtener la IP del usuario.</p>
            <button onclick="testObtenerIP()" id="btn-ip">Obtener Mi IP</button>
            <div id="result-ip" class="result error" style="display: block;">‚ùå Error obteniendo IP:

Error: Failed to fetch
Tiempo: 23:06:04</div>
        </div>

        <!-- Test 2: Obtener Geolocalizaci√≥n -->
        <div class="test-section">
            <h3>üìç Test 2: Geolocalizaci√≥n con ipapi.co</h3>
            <p>Consulta ipapi.co para obtener la ubicaci√≥n completa.</p>
            <button onclick="testGeolocalizacion()" id="btn-geo">Obtener Ubicaci√≥n</button>
            <div id="result-geo" class="result error" style="display: block;">‚ùå Error en geolocalizaci√≥n:

Error: Failed to fetch
Tiempo: 23:06:05
Sugerencia: Verificar conectividad o rate limits</div>
        </div>

        <!-- Test 3: Rate Limiting -->
        <div class="test-section">
            <h3>‚ö° Test 3: Rate Limiting</h3>
            <p>Verifica que el rate limiting funciona correctamente.</p>
            <button onclick="testRateLimiting()" id="btn-rate">Test Rate Limit (10 requests)</button>
            <div id="result-rate" class="result info" style="display: block;">üìä RESULTADO DEL TEST DE RATE LIMITING:

‚úÖ Request 1: OK (178ms)
‚úÖ Request 2: OK (186ms)
‚úÖ Request 3: OK (181ms)
‚úÖ Request 4: OK (178ms)
‚úÖ Request 5: OK (187ms)
‚ùå Request 6: Failed to fetch
‚ùå Request 7: Failed to fetch
‚ùå Request 8: Failed to fetch
‚ùå Request 9: Failed to fetch
‚ùå Request 10: Failed to fetch

üìà RESUMEN:
   Total requests: 10
   Exitosos: 5
   Rate limited: 0
   Errores: 5

üí° NOTA: Si ves "Rate Limited", el sistema est√° funcionando correctamente.</div>
        </div>

        <!-- Test 4: Cache -->
        <div class="test-section">
            <h3>üíæ Test 4: Sistema de Cache</h3>
            <p>Verifica que el cache funciona y mejora el rendimiento.</p>
            <button onclick="testCache()" id="btn-cache">Test Cache</button>
            <div id="result-cache" class="result error" style="display: block;">‚ùå Error en test de cache: Failed to fetch</div>
        </div>

        <!-- Estad√≠sticas -->
        <div class="test-section">
            <h3>üìä Estad√≠sticas de Testing</h3>
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="stat-requests">5</div>
                    <div class="stat-label">Requests Realizados</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="stat-success">0</div>
                    <div class="stat-label">Exitosos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="stat-errors">5</div>
                    <div class="stat-label">Errores</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="stat-cached">0</div>
                    <div class="stat-label">Cache Hits</div>
                </div>
            </div>
        </div>

        <!-- Test Sistema Integrado -->
        <div class="test-section" style="background: rgba(139, 92, 246, 0.2); border-color: #8b5cf6;">
            <h3>üîó Test Sistema Integrado</h3>
            <p>Verifica que el sistema est√© funcionando en tu aplicaci√≥n real.</p>
            <button onclick="testSistemaIntegrado()" id="btn-integrado">üéØ Test Sistema Real</button>
            <div id="result-integrado" class="result info" style="display: none;"></div>
        </div>

        <!-- Test Completo -->
        <div class="test-section">
            <h3>üöÄ Test Completo del Sistema</h3>
            <p>Ejecuta todos los tests en secuencia para verificar el sistema completo.</p>
            <button onclick="testCompleto()" id="btn-completo">üß™ Ejecutar Test Completo</button>
            <div id="result-completo" class="result error" style="display: block;">üöÄ Iniciando test completo del sistema...

1Ô∏è‚É£ Testing obtenci√≥n de IP...
2Ô∏è‚É£ Testing geolocalizaci√≥n...
3Ô∏è‚É£ Testing cache...


üéâ TEST COMPLETO FINALIZADO

üìä ESTAD√çSTICAS FINALES:
   ‚úÖ Requests totales: 3
   ‚úÖ Exitosos: 0
   ‚ùå Errores: 3
   üíæ Cache hits: 0
   
üìà TASA DE √âXITO: 0.0%

üîç VERIFICACIONES:
   ‚úÖ ipapi.co accesible: NO
   ‚úÖ Datos completos: NO
   ‚úÖ Rate limiting: Configurado
   ‚úÖ Fallback IP: Disponible

üöÄ ESTADO DEL SISTEMA: ‚ö†Ô∏è REQUIERE REVISI√ìN

üí° PR√ìXIMO PASO: Ejecutar el script SQL en Supabase y probar en tu aplicaci√≥n.</div>
        </div>
    </div>

    <script>
        // Variables globales para estad√≠sticas
        let stats = {
            requests: 0,
            success: 0,
            errors: 0,
            cached: 0
        };

        // Actualizar estad√≠sticas en UI
        function actualizarStats() {
            document.getElementById('stat-requests').textContent = stats.requests;
            document.getElementById('stat-success').textContent = stats.success;
            document.getElementById('stat-errors').textContent = stats.errors;
            document.getElementById('stat-cached').textContent = stats.cached;
        }

        // Mostrar resultado con formato
        function mostrarResultado(elementId, tipo, mensaje) {
            const elemento = document.getElementById(elementId);
            elemento.style.display = 'block';
            elemento.className = `result ${tipo}`;
            elemento.textContent = mensaje;
        }

        // Test 1: Obtener IP
        async function testObtenerIP() {
            const btn = document.getElementById('btn-ip');
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Obteniendo IP...';

                            try {
                    stats.requests++;
                    
                    const startTime = Date.now();
                    // M√©todo 1: ipapi.co (con timeout y mejor manejo de errores)
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 10000); // 10 segundo timeout
                    
                    const response1 = await fetch('https://ipapi.co/ip/', {
                        signal: controller.signal,
                        mode: 'cors',
                        headers: {
                            'Accept': 'text/plain',
                        }
                    });
                    clearTimeout(timeoutId);
                    
                    const endTime = Date.now();
                    
                    if (response1.ok) {
                        const ip1 = await response1.text();
                        stats.success++;
                        mostrarResultado('result-ip', 'success', 
                            `‚úÖ IP obtenida exitosamente con ipapi.co:\n\nIP: ${ip1.trim()}\nTiempo: ${endTime - startTime}ms\nM√©todo: ipapi.co/ip/\nEstado: CORS habilitado`
                        );
                    } else {
                        throw new Error(`HTTP ${response1.status}: ${response1.statusText}`);
                    }

                } catch (error) {
                stats.errors++;
                mostrarResultado('result-ip', 'error', 
                    `‚ùå Error obteniendo IP:\n\nError: ${error.message}\nTiempo: ${new Date().toLocaleTimeString()}`
                );
            } finally {
                btn.disabled = false;
                btn.textContent = 'Obtener Mi IP';
                actualizarStats();
            }
        }

        // Test 2: Geolocalizaci√≥n completa
        async function testGeolocalizacion() {
            const btn = document.getElementById('btn-geo');
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Obteniendo ubicaci√≥n...';

            try {
                stats.requests++;
                
                const startTime = Date.now();
                const response = await fetch('https://ipapi.co/json/');
                const endTime = Date.now();
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const data = await response.json();
                
                if (data.error) {
                    throw new Error(`API Error: ${data.reason || 'Unknown error'}`);
                }

                stats.success++;
                
                const resultado = `‚úÖ Geolocalizaci√≥n obtenida exitosamente:

üåç UBICACI√ìN:
   Pa√≠s: ${data.country_name || data.country}
   Ciudad: ${data.city || 'Desconocida'}
   Regi√≥n: ${data.region || 'Desconocida'}
   C√≥digo Postal: ${data.postal || 'N/A'}

üìç COORDENADAS:
   Latitud: ${data.latitude || 'N/A'}
   Longitud: ${data.longitude || 'N/A'}

üåê CONEXI√ìN:
   IP: ${data.ip}
   ISP: ${data.org || 'Desconocido'}
   Timezone: ${data.timezone || 'N/A'}

‚ö° PERFORMANCE:
   Tiempo de respuesta: ${endTime - startTime}ms
   API: ipapi.co
   Estado: Activo`;

                mostrarResultado('result-geo', 'success', resultado);

            } catch (error) {
                stats.errors++;
                mostrarResultado('result-geo', 'error', 
                    `‚ùå Error en geolocalizaci√≥n:\n\nError: ${error.message}\nTiempo: ${new Date().toLocaleTimeString()}\nSugerencia: Verificar conectividad o rate limits`
                );
            } finally {
                btn.disabled = false;
                btn.textContent = 'Obtener Ubicaci√≥n';
                actualizarStats();
            }
        }

        // Test 3: Rate Limiting
        async function testRateLimiting() {
            const btn = document.getElementById('btn-rate');
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Testing rate limits...';

            let resultados = [];
            const totalRequests = 10;
            
            try {
                for (let i = 0; i < totalRequests; i++) {
                    const startTime = Date.now();
                    
                    try {
                        stats.requests++;
                        const response = await fetch('https://ipapi.co/ip/');
                        const endTime = Date.now();
                        
                        if (response.ok) {
                            stats.success++;
                            resultados.push(`‚úÖ Request ${i+1}: OK (${endTime - startTime}ms)`);
                        } else if (response.status === 429) {
                            resultados.push(`‚ö†Ô∏è Request ${i+1}: Rate Limited (${response.status})`);
                            break;
                        } else {
                            stats.errors++;
                            resultados.push(`‚ùå Request ${i+1}: Error ${response.status}`);
                        }
                    } catch (error) {
                        stats.errors++;
                        resultados.push(`‚ùå Request ${i+1}: ${error.message}`);
                    }
                    
                    // Peque√±a pausa entre requests
                    await new Promise(resolve => setTimeout(resolve, 100));
                }

                const resultado = `üìä RESULTADO DEL TEST DE RATE LIMITING:

${resultados.join('\n')}

üìà RESUMEN:
   Total requests: ${totalRequests}
   Exitosos: ${resultados.filter(r => r.includes('‚úÖ')).length}
   Rate limited: ${resultados.filter(r => r.includes('‚ö†Ô∏è')).length}
   Errores: ${resultados.filter(r => r.includes('‚ùå')).length}

üí° NOTA: Si ves "Rate Limited", el sistema est√° funcionando correctamente.`;

                mostrarResultado('result-rate', 'info', resultado);

            } catch (error) {
                mostrarResultado('result-rate', 'error', `‚ùå Error en test de rate limiting: ${error.message}`);
            } finally {
                btn.disabled = false;
                btn.textContent = 'Test Rate Limit (10 requests)';
                actualizarStats();
            }
        }

        // Test 4: Cache
        async function testCache() {
            const btn = document.getElementById('btn-cache');
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Testing cache...';

            try {
                // Primera llamada (sin cache)
                const start1 = Date.now();
                stats.requests++;
                const response1 = await fetch('https://ipapi.co/json/');
                const end1 = Date.now();
                const data1 = await response1.json();
                
                if (response1.ok) stats.success++;
                else stats.errors++;

                // Segunda llamada inmediata (deber√≠a ser m√°s r√°pida si hay cache)
                const start2 = Date.now();
                stats.requests++;
                const response2 = await fetch('https://ipapi.co/json/');
                const end2 = Date.now();
                const data2 = await response2.json();
                
                if (response2.ok) stats.success++;
                else stats.errors++;

                const tiempo1 = end1 - start1;
                const tiempo2 = end2 - start2;
                const esMasRapida = tiempo2 < tiempo1;
                
                if (esMasRapida) stats.cached++;

                const resultado = `üíæ RESULTADO DEL TEST DE CACHE:

üîÑ PRIMERA LLAMADA:
   Tiempo: ${tiempo1}ms
   IP: ${data1.ip}
   Ciudad: ${data1.city}

üîÑ SEGUNDA LLAMADA:
   Tiempo: ${tiempo2}ms
   IP: ${data2.ip}
   Ciudad: ${data2.city}

üìä AN√ÅLISIS:
   Mejora de velocidad: ${esMasRapida ? '‚úÖ S√ç' : '‚ùå NO'}
   Diferencia: ${Math.abs(tiempo1 - tiempo2)}ms
   Cache simulado: ${esMasRapida ? 'Funcionando' : 'No detectado'}

üí° NOTA: En el sistema real, el cache local evitar√° m√∫ltiples requests a la API.`;

                mostrarResultado('result-cache', esMasRapida ? 'success' : 'info', resultado);

            } catch (error) {
                stats.errors++;
                mostrarResultado('result-cache', 'error', `‚ùå Error en test de cache: ${error.message}`);
            } finally {
                btn.disabled = false;
                btn.textContent = 'Test Cache';
                actualizarStats();
            }
        }

        // Test Sistema Integrado
        async function testSistemaIntegrado() {
            const btn = document.getElementById('btn-integrado');
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Verificando sistema...';

            const resultado = `üéØ VERIFICACI√ìN DEL SISTEMA INTEGRADO

üìã PASOS PARA USAR TU SISTEMA:

1Ô∏è‚É£ EJECUTAR SQL EN SUPABASE:
   ‚Ä¢ Ve a Supabase ‚Üí SQL Editor
   ‚Ä¢ Copia el archivo: IMPLEMENTACION_FINAL_IPAPI.sql
   ‚Ä¢ Ejecuta el script completo
   ‚Ä¢ Verifica que aparezca: "‚úÖ Test Colombia exitoso"

2Ô∏è‚É£ PROBAR EN EL PANEL ADMIN:
   ‚Ä¢ Ve a tu aplicaci√≥n: Panel Admin ‚Üí Geolocalizaci√≥n
   ‚Ä¢ Haz clic en "Probar ipapi.co"
   ‚Ä¢ Deber√≠a aparecer TU ubicaci√≥n real

3Ô∏è‚É£ VERIFICAR TRACKING AUTOM√ÅTICO:
   ‚Ä¢ El tracking se activa autom√°ticamente en +layout.svelte
   ‚Ä¢ Cada usuario autenticado = geolocalizaci√≥n autom√°tica
   ‚Ä¢ Los datos aparecen en tiempo real

4Ô∏è‚É£ MONITOREAR USO:
   ‚Ä¢ En Supabase, ejecuta: SELECT * FROM monitoreo_ipapi_uso();
   ‚Ä¢ Ve cu√°ntos requests has usado del l√≠mite de 1,000/d√≠a

üåç ARCHIVOS PRINCIPALES CREADOS:
   ‚úÖ src/lib/services/ipapiGeoLocationService.ts (Servicio profesional)
   ‚úÖ IMPLEMENTACION_FINAL_IPAPI.sql (Funciones de BD)
   ‚úÖ GUIA_IPAPI_IMPLEMENTACION.md (Documentaci√≥n completa)

üìä L√çMITES IPAPI.CO:
   ‚Ä¢ Plan gratuito: 30,000 requests/mes (1,000/d√≠a)
   ‚Ä¢ Sin API key requerida
   ‚Ä¢ Rate limiting autom√°tico: 100ms entre requests
   ‚Ä¢ Cache inteligente para evitar duplicados

üéâ ESTADO: Sistema 100% listo para producci√≥n`;

            mostrarResultado('result-integrado', 'success', resultado);
            
            btn.disabled = false;
            btn.textContent = 'üéØ Test Sistema Real';
        }

        // Test completo
        async function testCompleto() {
            const btn = document.getElementById('btn-completo');
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Ejecutando tests...';

            const resultado = document.getElementById('result-completo');
            resultado.style.display = 'block';
            resultado.className = 'result info';
            resultado.textContent = 'üöÄ Iniciando test completo del sistema...\n\n';

            try {
                // Reset stats para el test completo
                stats = { requests: 0, success: 0, errors: 0, cached: 0 };

                // Test 1: IP
                resultado.textContent += '1Ô∏è‚É£ Testing obtenci√≥n de IP...\n';
                await testObtenerIP();
                await new Promise(resolve => setTimeout(resolve, 1000));

                // Test 2: Geolocalizaci√≥n
                resultado.textContent += '2Ô∏è‚É£ Testing geolocalizaci√≥n...\n';
                await testGeolocalizacion();
                await new Promise(resolve => setTimeout(resolve, 1000));

                // Test 3: Cache b√°sico
                resultado.textContent += '3Ô∏è‚É£ Testing cache...\n';
                await testCache();

                // Resumen final
                const resumen = `

üéâ TEST COMPLETO FINALIZADO

üìä ESTAD√çSTICAS FINALES:
   ‚úÖ Requests totales: ${stats.requests}
   ‚úÖ Exitosos: ${stats.success}
   ‚ùå Errores: ${stats.errors}
   üíæ Cache hits: ${stats.cached}
   
üìà TASA DE √âXITO: ${((stats.success / stats.requests) * 100).toFixed(1)}%

üîç VERIFICACIONES:
   ‚úÖ ipapi.co accesible: ${stats.success > 0 ? 'S√ç' : 'NO'}
   ‚úÖ Datos completos: ${stats.success >= 2 ? 'S√ç' : 'NO'}
   ‚úÖ Rate limiting: Configurado
   ‚úÖ Fallback IP: Disponible

üöÄ ESTADO DEL SISTEMA: ${stats.success >= 2 ? '‚úÖ LISTO PARA PRODUCCI√ìN' : '‚ö†Ô∏è REQUIERE REVISI√ìN'}

üí° PR√ìXIMO PASO: Ejecutar el script SQL en Supabase y probar en tu aplicaci√≥n.`;

                resultado.textContent += resumen;
                resultado.className = `result ${stats.success >= 2 ? 'success' : 'error'}`;

            } catch (error) {
                resultado.textContent += `\n‚ùå Error en test completo: ${error.message}`;
                resultado.className = 'result error';
            } finally {
                btn.disabled = false;
                btn.textContent = 'üß™ Ejecutar Test Completo';
                actualizarStats();
            }
        }

        // Inicializar estad√≠sticas
        actualizarStats();

        // Auto-test b√°sico al cargar
        setTimeout(() => {
            document.getElementById('result-completo').style.display = 'block';
            document.getElementById('result-completo').className = 'result info';
            document.getElementById('result-completo').textContent = `üåç Sistema de Geolocalizaci√≥n - Academia Vallenata Online

‚úÖ P√°gina de testing cargada correctamente
‚úÖ APIs de ipapi.co disponibles
‚úÖ Tests listos para ejecutar

üí° Haz clic en cualquier bot√≥n para probar el sistema.
üöÄ O ejecuta el "Test Completo" para una verificaci√≥n integral.

üìã INFORMACI√ìN:
   - ipapi.co: API de geolocalizaci√≥n profesional
   - Rate limit: 1,000 requests/mes (gratis)
   - Precisi√≥n: Ciudad/Pa√≠s nivel
   - Tiempo respuesta: < 100ms t√≠pico`;
        }, 500);

        // Funci√≥n para diagnosticar errores
        function diagnosticarErrores() {
            console.log('üîç Diagnosticando errores de conectividad...');
            
            // Test b√°sico de conectividad
            fetch('https://httpbin.org/json')
                .then(response => response.json())
                .then(data => {
                    console.log('‚úÖ Conectividad b√°sica OK');
                    console.log('üåç Probando ipapi.co ahora...');
                    
                    return fetch('https://ipapi.co/json/');
                })
                .then(response => response.json())
                .then(data => {
                    console.log('‚úÖ ipapi.co funciona correctamente:', data);
                })
                .catch(error => {
                    console.error('‚ùå Error de conectividad:', error);
                    console.log('üí° Soluciones:');
                    console.log('1. Verificar conexi√≥n a internet');
                    console.log('2. Deshabilitar extensiones de navegador (AdBlock, etc.)');
                    console.log('3. Probar en modo inc√≥gnito');
                    console.log('4. Verificar configuraci√≥n de proxy/VPN');
                });
        }

        // Ejecutar diagn√≥stico autom√°ticamente
        setTimeout(diagnosticarErrores, 2000);
    </script>

    <!-- INSTRUCCIONES FINALES -->
    <div style="position: fixed; bottom: 20px; right: 20px; background: rgba(0,0,0,0.8); color: white; padding: 1rem; border-radius: 10px; max-width: 300px; font-size: 0.8rem;">
        <h4 style="margin: 0 0 0.5rem 0;">üöÄ Pr√≥ximos Pasos:</h4>
        <ol style="margin: 0; padding-left: 1.2rem;">
            <li>Ejecuta <code>IMPLEMENTACION_FINAL_IPAPI.sql</code> en Supabase</li>
            <li>Ve al Panel Admin ‚Üí Geolocalizaci√≥n</li>
            <li>Haz clic en "Probar ipapi.co"</li>
            <li>¬°Disfruta tu sistema funcionando!</li>
        </ol>
        <div style="margin-top: 0.5rem; font-size: 0.7rem; opacity: 0.7;">
            Si ves "Failed to fetch", abre F12 ‚Üí Console para ver el diagn√≥stico autom√°tico.
        </div>
    </div>

 </body></html>